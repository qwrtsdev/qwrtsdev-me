---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

export interface Props {
    title: string;
    desc?: string;
    link: string;
    thumbnail?: string;
    featured?: boolean;
    big_image?: boolean;
}

const { title, desc, link, thumbnail, featured, big_image } = Astro.props;
// const images = import.meta.glob<{ default: ImageMetadata }>(
//     "/src/assets/*.{jpeg,jpg,png,gif,webp}"
// );
// if (!images[thumbnail])
//     throw new Error(
//         `"${thumbnail}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif,webp}"`
//     );
---

{
    !title || !link ? (
        <p class="text-red-600">
            กรุณาใส่ข้อมูล "title" และ "link" ใน{" "}
            <span class="bg-red-200">src/data/links.json</span>
        </p>
    ) : (
        <a
            href={link}
            target="_blank"
            class={`group w-full p-4 rounded-xl hover:scale-[1.025] transition-all bg-neutral-800/70 text-neutral-100 border border-neutral-500 ${featured ? "relative overflow-hidden" : ""}`}
        >
            {featured && (
                <>
                    <div class="absolute top-0 left-[-75%] w-[5%] h-full bg-white/15 border-neutral-400/20 border-x skew-x-[-20deg] animate-[shine_3s_ease-in-out_infinite] pointer-events-none z-0" />
                    <div class="absolute top-0 left-[-75%] w-[8%] h-full bg-white/15 border-neutral-400/20 border-x skew-x-[-20deg] animate-[shine_3s_ease-in-out_infinite] pointer-events-none z-0 ml-[7%]" />
                </>
            )}

            <div class="relative z-10">
                {thumbnail && big_image ? (
                    <>
                        <img
                            src={thumbnail}
                            alt={title}
                            decoding="async"
                            loading="lazy"
                            class="mb-4 w-full object-cover rounded-lg"
                        />
                        <div class="flex flex-row justify-between">
                            <div class="flex flex-col flex-1">
                                <p class="h-6 line-clamp-1 font-bold">
                                    {title}
                                </p>
                                <p class="h-5 line-clamp-1 text-sm text-neutral-300">
                                    {desc || ""}
                                </p>
                            </div>
                            <Icon
                                name="newtab-icon"
                                class="w-3 h-3 opacity-0 group-hover:opacity-80 transition-opacity shrink-0 mt-1"
                            />
                        </div>
                    </>
                ) : thumbnail ? (
                    <div class="flex flex-row justify-between gap-4">
                        <img
                            src={thumbnail}
                            alt={title}
                            decoding="async"
                            loading="lazy"
                            class="w-12 h-12 object-cover rounded-md shrink-0"
                        />
                        <div class="flex flex-col flex-1">
                            <p class="h-6 line-clamp-1 font-bold">{title}</p>
                            <p class="h-5 line-clamp-1 text-sm text-neutral-300">
                                {desc || ""}
                            </p>
                        </div>
                        <Icon
                            name="newtab-icon"
                            class="w-3 h-3 opacity-0 group-hover:opacity-80 transition-opacity shrink-0 mt-1"
                        />
                    </div>
                ) : (
                    <div class="flex flex-row justify-between">
                        <div class="flex flex-col flex-1">
                            <p class="h-6 line-clamp-1 font-bold">{title}</p>
                            <p class="h-5 line-clamp-1 text-sm text-neutral-300">
                                {desc || ""}
                            </p>
                        </div>
                        <Icon
                            name="newtab-icon"
                            class="w-3 h-3 opacity-0 group-hover:opacity-80 transition-opacity shrink-0 mt-1"
                        />
                    </div>
                )}
            </div>
        </a>
    )
}
